<!doctype html>
<html lang="he" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>סימולטור כדור קופץ</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 900px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .language-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .lang-btn {
            padding: 10px 24px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: white;
            color: #667eea;
            transition: all 0.3s ease;
        }

        .lang-btn:hover {
            background: #f0f4ff;
        }

        .lang-btn.active {
            background: #667eea;
            color: white;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 36px;
            font-weight: bold;
            color: #2d3748;
            margin: 0 0 10px 0;
        }

        .subtitle {
            font-size: 18px;
            color: #718096;
            margin: 0;
        }

        .animation-area {
            background: linear-gradient(to bottom, #e0f2fe 0%, #f0f9ff 100%);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            height: 400px;
            border: 3px solid #0ea5e9;
            overflow: hidden;
        }

        .ball {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: absolute;
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #c92a2a);
            box-shadow: 
                inset -10px -10px 20px rgba(0, 0, 0, 0.3),
                inset 10px 10px 20px rgba(255, 255, 255, 0.3),
                0 10px 30px rgba(255, 107, 107, 0.5);
            transition: transform 0.05s linear;
        }

        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #0ea5e9;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-play {
            background: #10b981;
            color: white;
        }

        .btn-play:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .btn-pause {
            background: #f59e0b;
            color: white;
        }

        .btn-pause:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
        }

        .btn-step {
            background: #8b5cf6;
            color: white;
        }

        .btn-step:hover {
            background: #7c3aed;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
        }

        .btn-reset {
            background: #ef4444;
            color: white;
        }

        .btn-reset:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .settings {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .setting-row:last-child {
            margin-bottom: 0;
        }

        .setting-label {
            font-size: 16px;
            font-weight: 600;
            color: #475569;
        }

        .slider {
            width: 200px;
            height: 8px;
            border-radius: 4px;
            background: #cbd5e1;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        .value-display {
            font-size: 16px;
            font-weight: 700;
            color: #667eea;
            min-width: 50px;
            text-align: center;
        }

        .info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .info-text {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .frame-indicator {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 16px;
        }

        .status-message {
            display: inline-block;
            background: rgba(16, 185, 129, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            font-weight: 600;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="language-selector"><button class="lang-btn active" id="heBtn" onclick="switchLanguage('he')">עברית</button> <button class="lang-btn" id="arBtn" onclick="switchLanguage('ar')">العربية</button>
   </div>
   <div class="header">
    <h1 class="title" id="mainTitle">סימולטור כדור קופץ</h1>
    <p class="subtitle" id="subtitle">למד איך יוצרים אנימציה באמצעות רצף תמונות</p>
   </div>
   <div class="animation-area" id="animationArea">
    <div class="ball" id="ball"></div>
    <div class="ground"></div>
   </div>
   <div class="controls"><button class="btn btn-play" id="playBtn">▶ הפעל</button> <button class="btn btn-pause" id="pauseBtn" disabled>⏸ השהה</button> <button class="btn btn-step" id="stepBtn">⏭ פריים הבא</button> <button class="btn btn-reset" id="resetBtn">↻ אפס</button>
   </div>
   <div class="settings">
    <div class="setting-row"><span class="setting-label" id="speedLabel">מהירות אנימציה:</span> <input type="range" class="slider" id="speedSlider" min="0.1" max="10" step="0.1" value="5"> <span class="value-display" id="speedValue">5</span>
    </div>
   </div>
   <div class="info-box">
    <p class="info-text" id="frameLabel">פריים נוכחי: 0</p>
    <p class="info-text" id="fpsLabel" style="margin-top: 10px;">פריימים לשנייה: <span id="fpsValue">0</span></p>
    <div class="status-message" id="statusMessage" style="display: none;"></div>
   </div>
  </div>
  <script>
        const translations = {
            he: {
                main_title: "סימולטור כדור קופץ",
                subtitle: "למד איך יוצרים אנימציה באמצעות רצף תמונות",
                play_button: "▶ הפעל",
                pause_button: "⏸ השהה",
                step_button: "⏭ פריים הבא",
                reset_button: "↻ אפס",
                speed_label: "מהירות אנימציה:",
                frame_label: "פריים נוכחי:",
                fps_label: "פריימים לשנייה:",
                status_ended: "האנימציה הסתיימה - מאפס...",
                status_single: "פריים בודד"
            },
            ar: {
                main_title: "محاكي الكرة القافزة",
                subtitle: "تعلم كيفية إنشاء الرسوم المتحركة باستخدام تسلسل الإطارات",
                play_button: "▶ تشغيل",
                pause_button: "⏸ إيقاف مؤقت",
                step_button: "⏭ الإطار التالي",
                reset_button: "↻ إعادة تعيين",
                speed_label: "سرعة الرسوم المتحركة:",
                frame_label: "الإطار الحالي:",
                fps_label: "إطارات في الثانية:",
                status_ended: "انتهت الرسوم المتحركة - إعادة التعيين...",
                status_single: "إطار واحد"
            }
        };

        let currentLanguage = 'he';

        const defaultConfig = {
            main_title: translations.he.main_title,
            subtitle: translations.he.subtitle,
            play_button: translations.he.play_button,
            pause_button: translations.he.pause_button,
            step_button: translations.he.step_button,
            reset_button: translations.he.reset_button,
            speed_label: translations.he.speed_label,
            frame_label: translations.he.frame_label,
            fps_label: translations.he.fps_label,
            background_color: "#667eea",
            surface_color: "#ffffff",
            text_color: "#2d3748",
            primary_action_color: "#10b981",
            secondary_action_color: "#f59e0b"
        };

        function switchLanguage(lang) {
            currentLanguage = lang;
            const trans = translations[lang];
            
            document.getElementById('mainTitle').textContent = trans.main_title;
            document.getElementById('subtitle').textContent = trans.subtitle;
            document.getElementById('playBtn').textContent = trans.play_button;
            document.getElementById('pauseBtn').textContent = trans.pause_button;
            document.getElementById('stepBtn').textContent = trans.step_button;
            document.getElementById('resetBtn').textContent = trans.reset_button;
            document.getElementById('speedLabel').textContent = trans.speed_label;
            
            const frameLabel = document.getElementById('frameLabel');
            frameLabel.textContent = `${trans.frame_label} ${animationState.frame}`;
            
            const fpsLabel = document.getElementById('fpsLabel');
            const currentFps = document.getElementById('fpsValue').textContent;
            fpsLabel.innerHTML = `${trans.fps_label} <span id="fpsValue">${currentFps}</span>`;
            
            document.getElementById('heBtn').classList.toggle('active', lang === 'he');
            document.getElementById('arBtn').classList.toggle('active', lang === 'ar');
            
            if (window.elementSdk) {
                window.elementSdk.setConfig({
                    main_title: trans.main_title,
                    subtitle: trans.subtitle,
                    play_button: trans.play_button,
                    pause_button: trans.pause_button,
                    step_button: trans.step_button,
                    reset_button: trans.reset_button,
                    speed_label: trans.speed_label,
                    frame_label: trans.frame_label,
                    fps_label: trans.fps_label
                });
            }
        }

        let animationState = {
            isPlaying: false,
            frame: 0,
            position: { x: 50, y: 0 },
            velocity: { x: 3, y: 0 },
            gravity: 0.8,
            bounce: 0.85,
            speed: 5,
            animationId: null,
            stoppedFrames: 0,
            lastFrameTime: 0,
            frameCount: 0,
            fps: 0
        };

        const ball = document.getElementById('ball');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stepBtn = document.getElementById('stepBtn');
        const resetBtn = document.getElementById('resetBtn');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const animationArea = document.getElementById('animationArea');
        const statusMessage = document.getElementById('statusMessage');

        function showStatus(message) {
            statusMessage.textContent = message;
            statusMessage.style.display = 'inline-block';
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 2000);
        }

        function resetAnimation() {
            animationState.isPlaying = false;
            animationState.frame = 0;
            animationState.position = { x: 50, y: 0 };
            animationState.velocity = { x: 3, y: 0 };
            animationState.stoppedFrames = 0;
            animationState.lastFrameTime = 0;
            animationState.frameCount = 0;
            animationState.fps = 0;
            
            ball.style.left = '50px';
            ball.style.top = '0px';
            
            const frameLabel = document.getElementById('frameLabel');
            const trans = translations[currentLanguage];
            frameLabel.textContent = `${trans.frame_label} 0`;
            document.getElementById('fpsValue').textContent = '0';
            
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            
            if (animationState.animationId) {
                clearTimeout(animationState.animationId);
            }
        }

        function updateBallPosition() {
            const areaHeight = animationArea.clientHeight - 80;
            const areaWidth = animationArea.clientWidth - 80;

            animationState.velocity.y += animationState.gravity;
            animationState.position.y += animationState.velocity.y;
            animationState.position.x += animationState.velocity.x;

            if (animationState.position.y >= areaHeight) {
                animationState.position.y = areaHeight;
                animationState.velocity.y *= -animationState.bounce;
                
                if (Math.abs(animationState.velocity.y) < 1) {
                    animationState.velocity.y = 0;
                }
            }

            if (animationState.position.x >= areaWidth || animationState.position.x <= 0) {
                animationState.velocity.x *= -1;
                animationState.position.x = Math.max(0, Math.min(areaWidth, animationState.position.x));
            }

            ball.style.left = animationState.position.x + 'px';
            ball.style.top = animationState.position.y + 'px';

            animationState.frame++;
            
            const currentTime = Date.now();
            if (animationState.lastFrameTime === 0) {
                animationState.lastFrameTime = currentTime;
            }
            
            animationState.frameCount++;
            const timeDiff = currentTime - animationState.lastFrameTime;
            
            if (timeDiff >= 1000) {
                animationState.fps = Math.round((animationState.frameCount / timeDiff) * 1000);
                document.getElementById('fpsValue').textContent = animationState.fps;
                animationState.frameCount = 0;
                animationState.lastFrameTime = currentTime;
            }
            
            const frameLabel = document.getElementById('frameLabel');
            const trans = translations[currentLanguage];
            frameLabel.textContent = `${trans.frame_label} ${animationState.frame}`;

            const isAtBottom = Math.abs(animationState.position.y - areaHeight) < 1;
            const hasNoVerticalVelocity = Math.abs(animationState.velocity.y) < 0.5;
            
            if (isAtBottom && hasNoVerticalVelocity) {
                animationState.stoppedFrames++;
                
                if (animationState.stoppedFrames > 30) {
                    showStatus(translations[currentLanguage].status_ended);
                    setTimeout(() => {
                        resetAnimation();
                    }, 500);
                    return;
                }
            } else {
                animationState.stoppedFrames = 0;
            }
        }

        function animate() {
            if (!animationState.isPlaying) return;

            updateBallPosition();
            
            const delay = 50 / animationState.speed;
            animationState.animationId = setTimeout(() => {
                requestAnimationFrame(animate);
            }, delay);
        }

        playBtn.addEventListener('click', () => {
            animationState.isPlaying = true;
            playBtn.disabled = true;
            pauseBtn.disabled = false;
            animate();
        });

        pauseBtn.addEventListener('click', () => {
            animationState.isPlaying = false;
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            if (animationState.animationId) {
                clearTimeout(animationState.animationId);
            }
        });

        stepBtn.addEventListener('click', () => {
            if (animationState.isPlaying) {
                animationState.isPlaying = false;
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                if (animationState.animationId) {
                    clearTimeout(animationState.animationId);
                }
            }
            
            updateBallPosition();
            showStatus(translations[currentLanguage].status_single);
        });

        resetBtn.addEventListener('click', () => {
            resetAnimation();
        });

        speedSlider.addEventListener('input', (e) => {
            animationState.speed = parseFloat(e.target.value);
            speedValue.textContent = parseFloat(e.target.value).toFixed(1);
        });

        async function onConfigChange(config) {
            const mainTitle = document.getElementById('mainTitle');
            const subtitle = document.getElementById('subtitle');
            const playButton = document.getElementById('playBtn');
            const pauseButton = document.getElementById('pauseBtn');
            const stepButton = document.getElementById('stepBtn');
            const resetButton = document.getElementById('resetBtn');
            const speedLabel = document.getElementById('speedLabel');
            const frameLabel = document.getElementById('frameLabel');
            const fpsLabel = document.getElementById('fpsLabel');

            mainTitle.textContent = config.main_title || defaultConfig.main_title;
            subtitle.textContent = config.subtitle || defaultConfig.subtitle;
            playButton.textContent = config.play_button || defaultConfig.play_button;
            pauseButton.textContent = config.pause_button || defaultConfig.pause_button;
            stepButton.textContent = config.step_button || defaultConfig.step_button;
            resetButton.textContent = config.reset_button || defaultConfig.reset_button;
            speedLabel.textContent = config.speed_label || defaultConfig.speed_label;
            
            const frameLabelText = config.frame_label || defaultConfig.frame_label;
            frameLabel.textContent = `${frameLabelText} ${animationState.frame}`;
            
            const fpsLabelText = config.fps_label || defaultConfig.fps_label;
            const currentFps = document.getElementById('fpsValue').textContent;
            fpsLabel.innerHTML = `${fpsLabelText} <span id="fpsValue">${currentFps}</span>`;

            const backgroundColor = config.background_color || defaultConfig.background_color;
            const surfaceColor = config.surface_color || defaultConfig.surface_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryActionColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryActionColor = config.secondary_action_color || defaultConfig.secondary_action_color;

            document.body.style.background = `linear-gradient(135deg, ${backgroundColor} 0%, #764ba2 100%)`;
            document.querySelector('.container').style.background = surfaceColor;
            mainTitle.style.color = textColor;
            subtitle.style.color = textColor;
            
            const playBtnElement = document.querySelector('.btn-play');
            playBtnElement.style.background = primaryActionColor;
            
            const pauseBtnElement = document.querySelector('.btn-pause');
            pauseBtnElement.style.background = secondaryActionColor;
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                window.elementSdk.config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        },
                        {
                            get: () => config.surface_color || defaultConfig.surface_color,
                            set: (value) => {
                                window.elementSdk.config.surface_color = value;
                                window.elementSdk.setConfig({ surface_color: value });
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                window.elementSdk.config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        },
                        {
                            get: () => config.primary_action_color || defaultConfig.primary_action_color,
                            set: (value) => {
                                window.elementSdk.config.primary_action_color = value;
                                window.elementSdk.setConfig({ primary_action_color: value });
                            }
                        },
                        {
                            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                            set: (value) => {
                                window.elementSdk.config.secondary_action_color = value;
                                window.elementSdk.setConfig({ secondary_action_color: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["main_title", config.main_title || defaultConfig.main_title],
                    ["subtitle", config.subtitle || defaultConfig.subtitle],
                    ["play_button", config.play_button || defaultConfig.play_button],
                    ["pause_button", config.pause_button || defaultConfig.pause_button],
                    ["step_button", config.step_button || defaultConfig.step_button],
                    ["reset_button", config.reset_button || defaultConfig.reset_button],
                    ["speed_label", config.speed_label || defaultConfig.speed_label],
                    ["frame_label", config.frame_label || defaultConfig.frame_label],
                    ["fps_label", config.fps_label || defaultConfig.fps_label]
                ])
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99c511b246438e44',t:'MTc2Mjc3MjY2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>